<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Numpy | Josherich logs</title>
    <meta name="description" content="Josherich logs">
    <link rel="icon" href="/logs/logo.png">
  <link rel="manifest" href="/logs/manifest.json">
  <meta name="theme-color" content="#fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/logs/apple-touch-icon.png">
  <link rel="mask-icon" href="/logs/safari-pinned-tab.svg" color="#ff8549">
    
    <link rel="preload" href="/logs/assets/css/0.styles.7ecac9b5.css" as="style"><link rel="preload" href="/logs/assets/js/app.f98c735d.js" as="script"><link rel="preload" href="/logs/assets/js/2.df7b45b5.js" as="script"><link rel="preload" href="/logs/assets/js/22.e6e36746.js" as="script"><link rel="prefetch" href="/logs/assets/js/10.f3f37999.js"><link rel="prefetch" href="/logs/assets/js/11.6c51e49a.js"><link rel="prefetch" href="/logs/assets/js/12.cedf0acc.js"><link rel="prefetch" href="/logs/assets/js/13.c0aac8b3.js"><link rel="prefetch" href="/logs/assets/js/14.e515f413.js"><link rel="prefetch" href="/logs/assets/js/15.a7156ace.js"><link rel="prefetch" href="/logs/assets/js/16.86da6cc3.js"><link rel="prefetch" href="/logs/assets/js/17.5064e897.js"><link rel="prefetch" href="/logs/assets/js/18.efc70e0b.js"><link rel="prefetch" href="/logs/assets/js/19.7c20638b.js"><link rel="prefetch" href="/logs/assets/js/20.d024c098.js"><link rel="prefetch" href="/logs/assets/js/21.d4a62b38.js"><link rel="prefetch" href="/logs/assets/js/23.1566bb22.js"><link rel="prefetch" href="/logs/assets/js/24.dc5fe6b6.js"><link rel="prefetch" href="/logs/assets/js/25.7bf13951.js"><link rel="prefetch" href="/logs/assets/js/26.2671bacd.js"><link rel="prefetch" href="/logs/assets/js/27.92c9d814.js"><link rel="prefetch" href="/logs/assets/js/28.7a8e5cd1.js"><link rel="prefetch" href="/logs/assets/js/3.a5d03b9a.js"><link rel="prefetch" href="/logs/assets/js/4.75b1ce8e.js"><link rel="prefetch" href="/logs/assets/js/5.27eaf9c7.js"><link rel="prefetch" href="/logs/assets/js/6.7f5d89f0.js"><link rel="prefetch" href="/logs/assets/js/7.4ca882b0.js"><link rel="prefetch" href="/logs/assets/js/8.03ef91ae.js"><link rel="prefetch" href="/logs/assets/js/9.dce7702f.js">
    <link rel="stylesheet" href="/logs/assets/css/0.styles.7ecac9b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/logs/" class="home-link router-link-active"><!----> <span class="site-name">Josherich logs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/logs/" class="nav-link">Home</a></div> <a href="https://github.com/josherich/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/logs/" class="nav-link">Home</a></div> <a href="https://github.com/josherich/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Home</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Logs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/logs/logs.html" class="sidebar-link">Logs</a></li><li><a href="/logs/cloud.html" class="sidebar-link">cloud</a></li><li><a href="/logs/cpp.html" class="sidebar-link">CPP</a></li><li><a href="/logs/cs.html" class="sidebar-link">CS</a></li><li><a href="/logs/database.html" class="sidebar-link">Database</a></li><li><a href="/logs/draw.html" class="sidebar-link">Draw</a></li><li><a href="/logs/frontend.html" class="sidebar-link">Front end</a></li><li><a href="/logs/gaming.html" class="sidebar-link">Books</a></li><li><a href="/logs/josherich.html" class="sidebar-link">Josherich</a></li><li><a href="/logs/languages.html" class="sidebar-link">Language</a></li><li><a href="/logs/math.html" class="sidebar-link">Math</a></li><li><a href="/logs/ml.html" class="sidebar-link">Machine Learning</a></li><li><a href="/logs/nlp.html" class="sidebar-link">NLP</a></li><li><a href="/logs/numpy.html" class="active sidebar-link">Numpy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/logs/numpy.html#basic" class="sidebar-link">Basic</a></li><li class="sidebar-sub-header"><a href="/logs/numpy.html#matrix" class="sidebar-link">Matrix</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/logs/numpy.html#np-api" class="sidebar-link">np api</a></li></ul></li></ul></li><li><a href="/logs/ops.html" class="sidebar-link">Ops</a></li><li><a href="/logs/os.html" class="sidebar-link">OS</a></li><li><a href="/logs/papernotes.html" class="sidebar-link">paper reading notes</a></li><li><a href="/logs/pl.html" class="sidebar-link">PL</a></li><li><a href="/logs/R.html" class="sidebar-link">R</a></li><li><a href="/logs/RL.html" class="sidebar-link">Reinforcement Learning</a></li><li><a href="/logs/social.html" class="sidebar-link">Social</a></li><li><a href="/logs/vision.html" class="sidebar-link">Vision</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="numpy"><a href="#numpy" class="header-anchor">#</a> Numpy</h1> <h2 id="basic"><a href="#basic" class="header-anchor">#</a> Basic</h2> <h2 id="matrix"><a href="#matrix" class="header-anchor">#</a> Matrix</h2> <ul><li>M[i,j], to access the item in the ith row and jth column;</li> <li>M[i:j,:], to get the all the rows between the ith and j − 1th;</li> <li>M[:,i], to get the ith column of M;</li></ul> <p>dot product</p> <p>inner product</p> <p>transpose</p> <p>Identity Matrix</p> <h3 id="np-api"><a href="#np-api" class="header-anchor">#</a> np api</h3> <div class="language- extra-class"><pre class="language-text"><code>np.repeat(n, 3)
np.arange(n)
np.full((3, 3), 1, dtype=bool)
out = np.where(arr % 2 == 1, -1, arr)
np.reshape()
np.repeat(a, 3)
np.tile(a, 3)
np.concatenate
np.vstack
np.hstack
np.r_[a, b]
np.intersect1d(a, b)
</code></pre></div><ul><li>From 'a' remove all of 'b'</li></ul> <div class="language- extra-class"><pre class="language-text"><code>np.setdiff1d(a,b)
</code></pre></div><ul><li>Get the positions where elements of a and b match</li></ul> <div class="language- extra-class"><pre class="language-text"><code>np.where(a == b)

</code></pre></div><ul><li>get index meeting condition</li></ul> <div class="language- extra-class"><pre class="language-text"><code>
&gt; Method 1
index = np.where((a &gt;= 5) &amp; (a &lt;= 10))
a[index]

&gt; Method 2:
index = np.where(np.logical_and(a&gt;=5, a&lt;=10))
a[index]
</code></pre></div><ul><li>vectorize functions</li></ul> <div class="language- extra-class"><pre class="language-text"><code>pair_max = np.vectorize(maxx, otypes=[float])
</code></pre></div><ul><li>reorder columns</li></ul> <div class="language- extra-class"><pre class="language-text"><code>arr[:, [1,0,2]]
</code></pre></div><ul><li>reverse rows</li></ul> <div class="language- extra-class"><pre class="language-text"><code>arr[::-1]
</code></pre></div><ul><li>generate random matrix distribution</li></ul> <div class="language- extra-class"><pre class="language-text"><code>rand_arr = np.random.randint(low=5, high=10, size=(5,3)) + np.random.random((5,3))
&gt; or
rand_arr = np.random.uniform(5,10, size=(5,3))
</code></pre></div><ul><li>pretty print, scientific notation</li></ul> <div class="language- extra-class"><pre class="language-text"><code>np.set_printoptions(precision=3)
np.set_printoptions(suppress=True, precision=6)
np.set_printoptions(threshold=6)
np.set_printoptions(threshold=np.nan)
</code></pre></div><ul><li>keep text inact</li></ul> <div class="language- extra-class"><pre class="language-text"><code>iris = np.genfromtxt(url, delimiter=',', dtype='object')
</code></pre></div><ul><li>use columns when import</li></ul> <div class="language- extra-class"><pre class="language-text"><code>iris_2d = np.genfromtxt(url, delimiter=',', dtype='float', usecols=[0,1,2,3])
</code></pre></div><ul><li>normalize</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Smax, Smin = sepallength.max(), sepallength.min()
S = (sepallength - Smin)/(Smax - Smin)
</code></pre></div><ul><li>softmax</li></ul> <div class="language- extra-class"><pre class="language-text"><code>def softmax(x):
  &quot;&quot;&quot;Compute softmax values for each sets of scores in x.
  https://stackoverflow.com/questions/34968722/how-to-implement-the-softmax-function-in-python&quot;&quot;&quot;
  e_x = np.exp(x - np.max(x))
  return e_x / e_x.sum(axis=0)
</code></pre></div><ul><li>percentile</li></ul> <div class="language- extra-class"><pre class="language-text"><code>np.percentile(sepallength, q=[5, 95])
</code></pre></div><ul><li>insert random to random index</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Method 1
i, j = np.where(iris_2d)

i, j contain the row numbers and column numbers of 600 elements of iris_x
np.random.seed(100)
iris_2d[np.random.choice((i), 20), np.random.choice((j), 20)] = np.nan

&gt; Method 2
np.random.seed(100)
iris_2d[np.random.randint(150, size=20), np.random.randint(4, size=20)] = np.nan
</code></pre></div><ul><li>Print first 10 rows</li></ul> <div class="language- extra-class"><pre class="language-text"><code>print(iris_2d[:10])
</code></pre></div><ul><li>find nan value</li></ul> <div class="language- extra-class"><pre class="language-text"><code>print(&quot;Number of missing values: \n&quot;, np.isnan(iris_2d[:, 0]).sum())
print(&quot;Position of missing values: \n&quot;, np.where(np.isnan(iris_2d[:, 0])))
</code></pre></div><ul><li>filter</li></ul> <div class="language- extra-class"><pre class="language-text"><code>condition = (iris_2d[:, 2] &gt; 1.5) &amp; (iris_2d[:, 0] &lt; 5.0)
iris_2d[condition]
</code></pre></div><ul><li>correlation</li></ul> <div class="language- extra-class"><pre class="language-text"><code>np.corrcoef(iris[:, 0], iris[:, 2])[0, 1]

&gt; Solution 2
from scipy.stats.stats import pearsonr
corr, p_value = pearsonr(iris[:, 0], iris[:, 2])
print(corr)
</code></pre></div><ul><li>find unique value</li></ul> <div class="language- extra-class"><pre class="language-text"><code># Extract the species column as an array
species = np.array([row.tolist()[4] for row in iris])
</code></pre></div><ul><li>Get the unique values and the counts</li></ul> <div class="language- extra-class"><pre class="language-text"><code>np.unique(species, return_counts=True)
</code></pre></div><ul><li>num to category</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Bin petallength
petal_length_bin = np.digitize(iris[:, 2].astype('float'), [0, 3, 5, 10])

&gt; Map it to respective category
label_map = {1: 'small', 2: 'medium', 3: 'large', 4: np.nan}
petal_length_cat = [label_map[x] for x in petal_length_bin]
</code></pre></div><ul><li>create new columns</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Compute volume
sepallength = iris_2d[:, 0].astype('float')
petallength = iris_2d[:, 2].astype('float')
volume = (np.pi * petallength * (sepallength2))/3


&gt; Introduce new dimension to match iris_2d's
volume = volume[:, np.newaxis]

# Add the new column
out = np.hstack([iris_2d, volume])
</code></pre></div><ul><li>probabilistic sampling</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Get the species column
species = iris[:, 4]

&gt; Approach 1: Generate Probablistically
np.random.seed(100)
a = np.array(['Iris-setosa', 'Iris-versicolor', 'Iris-virginica'])
species_out = np.random.choice(a, 150, p=[0.5, 0.25, 0.25])

# Approach 2: Probablistic Sampling (preferred)
np.random.seed(100)
probs = np.r_[np.linspace(0, 0.500, num=50), np.linspace(0.501, .750, num=50), np.linspace(.751, 1.0, num=50)]
index = np.searchsorted(probs, np.random.random(150))
species_out = species[index]
print(np.unique(species_out, return_counts=True))
</code></pre></div><ul><li>get value grouped by another column</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Get the species and petal length columns
petal_len_setosa = iris[iris[:, 4] == b'Iris-setosa', [2]].astype('float')

&gt; Get the second last value
np.unique(np.sort(petal_len_setosa))[-2]
</code></pre></div><ul><li>sort by column</li></ul> <div class="language- extra-class"><pre class="language-text"><code>print(iris[iris[:,0].argsort()][:20])
</code></pre></div><ul><li>find most freq</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Solution:
vals, counts = np.unique(iris[:, 3], return_counts=True)
print(vals[np.argmax(counts)])
</code></pre></div><ul><li>cutoff value</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Solution 1: Using np.clip
np.clip(a, a_min=10, a_max=30)

&gt; Solution 2: Using np.where
print(np.where(a &lt; 10, 10, np.where(a &gt; 30, 30, a)))
</code></pre></div><ul><li>generate one-hot array</li></ul> <div class="language- extra-class"><pre class="language-text"><code>def one_hot_encodings(arr):
    uniqs = np.unique(arr)
    out = np.zeros((arr.shape[0], uniqs.shape[0]))
    for i, k in enumerate(arr):
        out[i, k-1] = 1
    return out
</code></pre></div><ul><li>one_hot_encodings(arr)</li></ul> <div class="language- extra-class"><pre class="language-text"><code>array([[ 0.,  1.,  0.],
       [ 0.,  0.,  1.],
       [ 0.,  1.,  0.],
       [ 0.,  1.,  0.],
       [ 0.,  1.,  0.],
       [ 1.,  0.,  0.]])

&gt; Method 2:
(arr[:, None] == np.unique(arr)).view(np.int8)
</code></pre></div><ul><li>create category id</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; Solution:
output = [np.argwhere(np.unique(species_small) == s).tolist()[0][0] for val in np.unique(species_small) for s in species_small[species_small==val]]

&gt; Solution: For Loop version
output = []
uniqs = np.unique(species_small)

for val in uniqs:  # uniq values in group
    for s in species_small[species_small==val]:  # each element in group
        groupid = np.argwhere(uniqs == s).tolist()[0][0]  # groupid
        output.append(groupid)

print(output)
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/josherich/blog/edit/master/logs/numpy.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/logs/nlp.html" class="prev">NLP</a></span> <span class="next"><a href="/logs/ops.html">Ops</a>
      →
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup><!----></div></div>
    <script src="/logs/assets/js/app.f98c735d.js" defer></script><script src="/logs/assets/js/2.df7b45b5.js" defer></script><script src="/logs/assets/js/22.e6e36746.js" defer></script>
  </body>
</html>
