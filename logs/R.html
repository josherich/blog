<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>R | Josherich logs</title>
    <meta name="description" content="Josherich logs">
    <link rel="icon" href="/logs/logo.png">
  <link rel="manifest" href="/logs/manifest.json">
  <meta name="theme-color" content="#fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/logs/apple-touch-icon.png">
  <link rel="mask-icon" href="/logs/safari-pinned-tab.svg" color="#ff8549">
    
    <link rel="preload" href="/logs/assets/css/0.styles.7191ec3a.css" as="style"><link rel="preload" href="/logs/assets/js/app.09a71387.js" as="script"><link rel="preload" href="/logs/assets/js/2.5fba0fc3.js" as="script"><link rel="preload" href="/logs/assets/js/6.d8e82984.js" as="script"><link rel="prefetch" href="/logs/assets/js/10.d006e7a8.js"><link rel="prefetch" href="/logs/assets/js/11.fd749eab.js"><link rel="prefetch" href="/logs/assets/js/12.e197d713.js"><link rel="prefetch" href="/logs/assets/js/13.5faee3eb.js"><link rel="prefetch" href="/logs/assets/js/14.dd1edca1.js"><link rel="prefetch" href="/logs/assets/js/15.8ccfa7a9.js"><link rel="prefetch" href="/logs/assets/js/16.0254efc1.js"><link rel="prefetch" href="/logs/assets/js/17.e177a4da.js"><link rel="prefetch" href="/logs/assets/js/18.1cf5c84a.js"><link rel="prefetch" href="/logs/assets/js/19.0a4d2d26.js"><link rel="prefetch" href="/logs/assets/js/20.6ad277bf.js"><link rel="prefetch" href="/logs/assets/js/21.f653a922.js"><link rel="prefetch" href="/logs/assets/js/22.d66a1538.js"><link rel="prefetch" href="/logs/assets/js/23.c2b61054.js"><link rel="prefetch" href="/logs/assets/js/24.a688e03c.js"><link rel="prefetch" href="/logs/assets/js/25.ce0b2b01.js"><link rel="prefetch" href="/logs/assets/js/26.98393859.js"><link rel="prefetch" href="/logs/assets/js/27.9c56208f.js"><link rel="prefetch" href="/logs/assets/js/28.2b361e5f.js"><link rel="prefetch" href="/logs/assets/js/3.e79b47f3.js"><link rel="prefetch" href="/logs/assets/js/4.824b2f94.js"><link rel="prefetch" href="/logs/assets/js/5.cf7ef866.js"><link rel="prefetch" href="/logs/assets/js/7.99d61cc4.js"><link rel="prefetch" href="/logs/assets/js/8.1099fc02.js"><link rel="prefetch" href="/logs/assets/js/9.64f7f7fe.js">
    <link rel="stylesheet" href="/logs/assets/css/0.styles.7191ec3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/logs/" class="home-link router-link-active"><!----> <span class="site-name">Josherich logs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/logs/" class="nav-link">Home</a></div> <a href="https://github.com/josherich/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/logs/" class="nav-link">Home</a></div> <a href="https://github.com/josherich/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Home</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Logs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/logs/logs.html" class="sidebar-link">Logs</a></li><li><a href="/logs/cloud.html" class="sidebar-link">cloud</a></li><li><a href="/logs/cpp.html" class="sidebar-link">CPP</a></li><li><a href="/logs/cs.html" class="sidebar-link">CS</a></li><li><a href="/logs/database.html" class="sidebar-link">Database</a></li><li><a href="/logs/draw.html" class="sidebar-link">Draw</a></li><li><a href="/logs/frontend.html" class="sidebar-link">Front end</a></li><li><a href="/logs/gaming.html" class="sidebar-link">Books</a></li><li><a href="/logs/josherich.html" class="sidebar-link">Josherich</a></li><li><a href="/logs/languages.html" class="sidebar-link">Language</a></li><li><a href="/logs/math.html" class="sidebar-link">Math</a></li><li><a href="/logs/ml.html" class="sidebar-link">Machine Learning</a></li><li><a href="/logs/nlp.html" class="sidebar-link">NLP</a></li><li><a href="/logs/numpy.html" class="sidebar-link">Numpy</a></li><li><a href="/logs/ops.html" class="sidebar-link">Ops</a></li><li><a href="/logs/os.html" class="sidebar-link">OS</a></li><li><a href="/logs/papernotes.html" class="sidebar-link">paper reading notes</a></li><li><a href="/logs/pl.html" class="sidebar-link">PL</a></li><li><a href="/logs/R.html" class="active sidebar-link">R</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/logs/R.html#_1-加载数据" class="sidebar-link">1. 加载数据</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#_2-预处理数据" class="sidebar-link">2. 预处理数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/logs/R.html#_2-1-合并-dataframe" class="sidebar-link">2.1 合并 dataframe</a></li></ul></li><li class="sidebar-sub-header"><a href="/logs/R.html#_3-搜索关键词" class="sidebar-link">3. 搜索关键词</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#_4-分词处理" class="sidebar-link">4. 分词处理</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#_4-计算特征词，词义复杂度" class="sidebar-link">4. 计算特征词，词义复杂度</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#_5-lda" class="sidebar-link">5. LDA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/logs/R.html#_5-1-计算-lda-主题数量" class="sidebar-link">5.1 计算 LDA 主题数量</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#_5-2-计算-lda-矩阵" class="sidebar-link">5.2 计算 LDA 矩阵</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#_5-3-对主题分类" class="sidebar-link">5.3 对主题分类</a></li></ul></li><li class="sidebar-sub-header"><a href="/logs/R.html#fre" class="sidebar-link">FRE</a></li><li class="sidebar-sub-header"><a href="/logs/R.html#保存-workspace" class="sidebar-link">保存 workspace</a></li></ul></li><li><a href="/logs/RL.html" class="sidebar-link">Reinforcement Learning</a></li><li><a href="/logs/social.html" class="sidebar-link">Social</a></li><li><a href="/logs/vision.html" class="sidebar-link">Vision</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="r"><a href="#r" class="header-anchor">#</a> R</h1> <h2 id="_1-加载数据"><a href="#_1-加载数据" class="header-anchor">#</a> 1. 加载数据</h2> <p>下载新闻数据集</p> <div class="language-R extra-class"><pre class="language-r"><code><span class="token comment"># 获取当前工作目录</span>
getwd<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 设定当前工作目录</span>
setwd<span class="token punctuation">(</span><span class="token string">&quot;/Users/{username}/project/&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 载入数据，如果数据较大，推荐使用 data.table</span>
<span class="token comment"># https://www.r-bloggers.com/efficiency-of-importing-large-csv-files-in-r/</span>
library<span class="token punctuation">(</span>data.table<span class="token punctuation">)</span>

datac <span class="token operator">&lt;-</span> fread<span class="token punctuation">(</span><span class="token string">&quot;page_entity_20180511.csv&quot;</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_2-预处理数据"><a href="#_2-预处理数据" class="header-anchor">#</a> 2. 预处理数据</h2> <div class="language-R extra-class"><pre class="language-r"><code><span class="token comment"># 从 HTML 中提取文本</span>
library<span class="token punctuation">(</span>htm2txt<span class="token punctuation">)</span>

<span class="token comment"># 重命名列名</span>
names<span class="token punctuation">(</span>datac<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_url&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_content&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_host_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;created_at&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;updated_at&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_image&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_topics&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;page_date&quot;</span><span class="token punctuation">)</span>

titles <span class="token operator">&lt;-</span> datac<span class="token operator">$</span>page_title
titles <span class="token operator">&lt;-</span> htm2txt<span class="token punctuation">(</span>titles<span class="token punctuation">)</span>
titles <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">&quot;n\t+&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> titles<span class="token punctuation">)</span>

urls <span class="token operator">&lt;-</span> datac<span class="token operator">$</span>page_url
urls <span class="token operator">&lt;-</span> gsub<span class="token punctuation">(</span><span class="token string">&quot;n\t+&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> urls<span class="token punctuation">)</span>

datac<span class="token operator">$</span>page_title <span class="token operator">&lt;-</span> titles
datac<span class="token operator">$</span>page_url <span class="token operator">&lt;-</span> urls

write.csv<span class="token punctuation">(</span>file<span class="token operator">=</span><span class="token string">&quot;page_entity.csv&quot;</span><span class="token punctuation">,</span> x<span class="token operator">=</span>datac<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-1-合并-dataframe"><a href="#_2-1-合并-dataframe" class="header-anchor">#</a> 2.1 合并 dataframe</h3> <div class="language-R extra-class"><pre class="language-r"><code><span class="token comment"># 读取另一张存有正文内容的表格</span>
data_content <span class="token operator">=</span> fread<span class="token punctuation">(</span><span class="token string">&quot;page_content_full.csv&quot;</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>

datam <span class="token operator">&lt;-</span> merge<span class="token punctuation">(</span>x<span class="token operator">=</span>data<span class="token punctuation">,</span> y<span class="token operator">=</span>dfcontent<span class="token punctuation">,</span> by.x<span class="token operator">=</span><span class="token string">&quot;V3&quot;</span><span class="token punctuation">,</span> by.y<span class="token operator">=</span><span class="token string">&quot;page_url&quot;</span><span class="token punctuation">,</span> all.x<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>

datacontent <span class="token operator">&lt;-</span> datam<span class="token punctuation">[</span>datam<span class="token operator">$</span>page_content <span class="token operator">!=</span> <span class="token string">&quot;NA&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="_3-搜索关键词"><a href="#_3-搜索关键词" class="header-anchor">#</a> 3. 搜索关键词</h2> <div class="language-R extra-class"><pre class="language-r"><code>text_with_s <span class="token operator">&lt;-</span> grep<span class="token punctuation">(</span><span class="token string">&quot;美国&quot;</span><span class="token punctuation">,</span> texts<span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">)</span>

text_with_s <span class="token operator">&lt;-</span> grep<span class="token punctuation">(</span><span class="token string">&quot;美国&quot;</span><span class="token punctuation">,</span> texts<span class="token punctuation">(</span>titles<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_4-分词处理"><a href="#_4-分词处理" class="header-anchor">#</a> 4. 分词处理</h2> <div class="language-R extra-class"><pre class="language-r"><code>install.packages<span class="token punctuation">(</span><span class="token string">&quot;jiebaR&quot;</span><span class="token punctuation">)</span>
library<span class="token punctuation">(</span><span class="token string">&quot;jiebaR&quot;</span><span class="token punctuation">)</span>

cc <span class="token operator">=</span> worker<span class="token punctuation">(</span>bylines <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> stop_word <span class="token operator">=</span> <span class="token string">&quot;stopwords_zh_cn.txt&quot;</span><span class="token punctuation">)</span>
tagging <span class="token operator">=</span> worker<span class="token punctuation">(</span><span class="token string">&quot;tag&quot;</span><span class="token punctuation">)</span>

tagger <span class="token operator">=</span> worker<span class="token punctuation">(</span><span class="token string">'tag'</span><span class="token punctuation">)</span>
tokencn <span class="token operator">=</span> segment<span class="token punctuation">(</span>contents<span class="token punctuation">,</span> cc<span class="token punctuation">)</span>

tags <span class="token operator">=</span> vector_tag<span class="token punctuation">(</span>tokencn<span class="token punctuation">,</span> tagger<span class="token punctuation">)</span>
tagsns <span class="token operator">=</span> tags<span class="token punctuation">[</span>grep<span class="token punctuation">(</span><span class="token string">&quot;^n&quot;</span><span class="token punctuation">,</span> names<span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

extract <span class="token operator">=</span> worker<span class="token punctuation">(</span><span class="token string">&quot;keywords&quot;</span><span class="token punctuation">,</span> topn <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
kws <span class="token operator">=</span> vector_keywords<span class="token punctuation">(</span>tokencn<span class="token punctuation">)</span>

</code></pre></div><h2 id="_4-计算特征词，词义复杂度"><a href="#_4-计算特征词，词义复杂度" class="header-anchor">#</a> 4. 计算特征词，词义复杂度</h2> <div class="language-R extra-class"><pre class="language-r"><code>cal_dfm <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  datap <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token operator">$</span>V5 <span class="token operator">==</span> id<span class="token punctuation">]</span>

  sizep <span class="token operator">=</span> lengths<span class="token punctuation">(</span>datap<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

  contents <span class="token operator">=</span> datap<span class="token operator">$</span>cleancontent

  tokensp <span class="token operator">=</span> tokens<span class="token punctuation">(</span>contents<span class="token punctuation">)</span>
  tokencn <span class="token operator">=</span> segment<span class="token punctuation">(</span>contents<span class="token punctuation">,</span> cc<span class="token punctuation">)</span>
  dfmp <span class="token operator">&lt;-</span> dfm<span class="token punctuation">(</span>tokensp<span class="token punctuation">,</span> remove <span class="token operator">=</span> stopwords<span class="token punctuation">(</span><span class="token string">&quot;chinese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> remove_punct <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
  topfeatures<span class="token punctuation">(</span>dfmp<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
  dfmp
<span class="token punctuation">}</span>

cal_dfm_tfidf <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>dfm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  dfm_tfidf <span class="token operator">&lt;-</span> dfm_tfidf<span class="token punctuation">(</span>dfm<span class="token punctuation">,</span> scheme_tf <span class="token operator">=</span> <span class="token string">&quot;prop&quot;</span><span class="token punctuation">)</span>
  topfeatures<span class="token punctuation">(</span>dfm_tfidf<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
  dfm_tfidf
<span class="token punctuation">}</span>

cal_ttr <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  datap <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token operator">$</span>V5 <span class="token operator">==</span> id<span class="token punctuation">]</span>
  contents <span class="token operator">=</span> datap<span class="token operator">$</span>cleancontent
  tokensp <span class="token operator">=</span> tokens<span class="token punctuation">(</span>contents<span class="token punctuation">)</span>
  trr <span class="token operator">=</span> ntype<span class="token punctuation">(</span>tokensp<span class="token punctuation">)</span> <span class="token operator">/</span> lengths<span class="token punctuation">(</span>tokensp<span class="token punctuation">)</span>
  hist<span class="token punctuation">(</span>ttr<span class="token punctuation">)</span>
  ttr
<span class="token punctuation">}</span>

calfeature<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
getttr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

</code></pre></div><h2 id="_5-lda"><a href="#_5-lda" class="header-anchor">#</a> 5. LDA</h2> <h3 id="_5-1-计算-lda-主题数量"><a href="#_5-1-计算-lda-主题数量" class="header-anchor">#</a> 5.1 计算 LDA 主题数量</h3> <div class="language-R extra-class"><pre class="language-r"><code>dfm1 <span class="token operator">&lt;-</span> dfm<span class="token punctuation">(</span>datacontent<span class="token operator">$</span>page_content<span class="token punctuation">,</span> remove <span class="token operator">=</span> stopwords<span class="token punctuation">(</span><span class="token string">&quot;chinese&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> remove_punct <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>

result <span class="token operator">&lt;-</span> FindTopicsNumber<span class="token punctuation">(</span>
  dfm1<span class="token punctuation">,</span>
  topics <span class="token operator">=</span> seq<span class="token punctuation">(</span>from <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> to <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">,</span> by <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  metrics <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">&quot;Griffiths2004&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CaoJuan2009&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Arun2010&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Deveaud2014&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  method <span class="token operator">=</span> <span class="token string">&quot;Gibbs&quot;</span><span class="token punctuation">,</span>
  control <span class="token operator">=</span> list<span class="token punctuation">(</span>seed <span class="token operator">=</span> <span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  mc.cores <span class="token operator">=</span> <span class="token number">2L</span><span class="token punctuation">,</span>
  verbose <span class="token operator">=</span> <span class="token boolean">TRUE</span>
<span class="token punctuation">)</span>
FindTopicsNumber_plot<span class="token punctuation">(</span>result<span class="token punctuation">)</span>

number_of_topics <span class="token operator">=</span> <span class="token number">40</span>
</code></pre></div><h3 id="_5-2-计算-lda-矩阵"><a href="#_5-2-计算-lda-矩阵" class="header-anchor">#</a> 5.2 计算 LDA 矩阵</h3> <div class="language-R extra-class"><pre class="language-r"><code>tm1 <span class="token operator">&lt;-</span> LDA<span class="token punctuation">(</span>dfm1<span class="token punctuation">,</span> k <span class="token operator">=</span> number_of_topics<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">&quot;Gibbs&quot;</span><span class="token punctuation">,</span>  control <span class="token operator">=</span> list<span class="token punctuation">(</span>seed <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

library<span class="token punctuation">(</span>tidytext<span class="token punctuation">)</span>
tmt1 <span class="token operator">&lt;-</span> tidy<span class="token punctuation">(</span>tm1<span class="token punctuation">,</span> matrix<span class="token operator">=</span><span class="token string">&quot;beta&quot;</span><span class="token punctuation">)</span>

terms1 <span class="token operator">&lt;-</span> tmt1  <span class="token percent-operator operator">%&gt;%</span>
  group_by<span class="token punctuation">(</span>topic<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  top_n<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> beta<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  ungroup<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  arrange<span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token operator">-</span>beta<span class="token punctuation">)</span>

terms1 <span class="token percent-operator operator">%&gt;%</span>
  mutate<span class="token punctuation">(</span>term <span class="token operator">=</span> reorder<span class="token punctuation">(</span>term<span class="token punctuation">,</span> beta<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  ggplot<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>term<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> fill <span class="token operator">=</span> factor<span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_col<span class="token punctuation">(</span>show.legend <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  facet_wrap<span class="token punctuation">(</span><span class="token operator">~</span> topic<span class="token punctuation">,</span> scales <span class="token operator">=</span> <span class="token string">&quot;free&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  coord_flip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  theme<span class="token punctuation">(</span>text <span class="token operator">=</span> element_text<span class="token punctuation">(</span>family <span class="token operator">=</span> <span class="token string">'STHeiti'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-3-对主题分类"><a href="#_5-3-对主题分类" class="header-anchor">#</a> 5.3 对主题分类</h3> <div class="language-R extra-class"><pre class="language-r"><code>post <span class="token operator">&lt;-</span> posterior<span class="token punctuation">(</span>tm1<span class="token punctuation">,</span> dfm1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;topics&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

postmat <span class="token operator">&lt;-</span> as.data.frame<span class="token punctuation">(</span>post<span class="token punctuation">)</span>

postdat <span class="token operator">&lt;-</span> add_rownames<span class="token punctuation">(</span>postmat<span class="token punctuation">,</span> <span class="token string">&quot;doc_name&quot;</span><span class="token punctuation">)</span>

colnames<span class="token punctuation">(</span>postdat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> apply<span class="token punctuation">(</span>terms<span class="token punctuation">(</span>tm1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> paste<span class="token punctuation">,</span> collapse<span class="token operator">=</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span>

heatmap<span class="token punctuation">(</span>post<span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>

group_documents <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>topic_vec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sorted <span class="token operator">&lt;-</span> sort<span class="token punctuation">(</span>topic_vec<span class="token punctuation">,</span> decreasing <span class="token operator">=</span> T<span class="token punctuation">,</span> index.return<span class="token operator">=</span>T<span class="token punctuation">)</span>
  dists <span class="token operator">&lt;-</span> sorted<span class="token operator">$</span>x
  index <span class="token operator">&lt;-</span> sorted<span class="token operator">$</span>ix
  max <span class="token operator">&lt;-</span> as.numeric<span class="token punctuation">(</span>dists<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&lt;</span> <span class="token number">0.7</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    threshold <span class="token operator">&lt;-</span> max <span class="token operator">*</span> <span class="token number">0.8</span>
    names<span class="token punctuation">(</span>dists<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> index
    return<span class="token punctuation">(</span>dists<span class="token punctuation">[</span>dists <span class="token operator">&gt;</span> threshold<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

groups <span class="token operator">&lt;-</span> sapply<span class="token punctuation">(</span>postdat<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> group_documents<span class="token punctuation">)</span>

</code></pre></div><h2 id="fre"><a href="#fre" class="header-anchor">#</a> FRE</h2> <div class="language-R extra-class"><pre class="language-r"><code>cal_fre <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ids<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  datap <span class="token operator">&lt;-</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">&quot;V5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cleancontent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  datap <span class="token operator">&lt;-</span> datap<span class="token punctuation">[</span>V5 <span class="token percent-operator operator">%in%</span> ids<span class="token punctuation">]</span>
  all_measures <span class="token operator">&lt;-</span> textstat_readability<span class="token punctuation">(</span>datap<span class="token operator">$</span>cleancontent<span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token string">&quot;Flesch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Dale.Chall&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SMOG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Coleman.Liau&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Fucks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

all_measures <span class="token operator">&lt;-</span> cal_fre<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

readability_matrix <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>all_measures<span class="token operator">$</span>Flesch<span class="token punctuation">,</span> all_measures<span class="token operator">$</span>Dale.Chall<span class="token punctuation">,</span> all_measures<span class="token operator">$</span>SMOG<span class="token punctuation">,</span> all_measures<span class="token operator">$</span>Coleman.Liau<span class="token punctuation">,</span> all_measures<span class="token operator">$</span>Fucks<span class="token punctuation">)</span>

fre_core <span class="token operator">&lt;-</span> cor<span class="token punctuation">(</span>readability_matrix<span class="token punctuation">)</span>
fre_core

datap<span class="token operator">$</span>fre_flesch <span class="token operator">&lt;-</span> all_measures<span class="token operator">$</span>Flesch
datap<span class="token operator">$</span>fre_dc <span class="token operator">&lt;-</span> all_measures<span class="token operator">$</span>Dale.Chall
datap<span class="token operator">$</span>fre_smog <span class="token operator">&lt;-</span> all_measures<span class="token operator">$</span>SMOG
datap<span class="token operator">$</span>fre_cl <span class="token operator">&lt;-</span> all_measures<span class="token operator">$</span>Coleman.Liau
datap<span class="token operator">$</span>fre_fucks <span class="token operator">&lt;-</span> all_measures<span class="token operator">$</span>Fucks

hist<span class="token punctuation">(</span>datap<span class="token punctuation">[</span>datap<span class="token operator">$</span>V5 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">$</span>fre_flesch<span class="token punctuation">,</span> xlim<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span><span class="token string">&quot;FD&quot;</span><span class="token punctuation">)</span>

std <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sd<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">/</span>sqrt<span class="token punctuation">(</span>length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="保存-workspace"><a href="#保存-workspace" class="header-anchor">#</a> 保存 workspace</h2> <div class="language-R extra-class"><pre class="language-r"><code>save.image<span class="token punctuation">(</span><span class="token string">&quot;workspace.RData&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><a href="https://cran.r-project.org/web/packages/topicmodels/topicmodels.pdf" target="_blank" rel="noopener noreferrer">R topicmodels<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cran.r-project.org/web/packages/ldatuning/vignettes/topics.html" target="_blank" rel="noopener noreferrer">LDA topic number tuning<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/josherich/blog/edit/master/logs/R.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/logs/pl.html" class="prev">PL</a></span> <span class="next"><a href="/logs/RL.html">Reinforcement Learning</a>
      →
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup><!----></div></div>
    <script src="/logs/assets/js/app.09a71387.js" defer></script><script src="/logs/assets/js/2.5fba0fc3.js" defer></script><script src="/logs/assets/js/6.d8e82984.js" defer></script>
  </body>
</html>
